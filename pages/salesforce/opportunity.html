<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Salesforce｜商談の作成〜フェーズ管理</title>
  <link rel="stylesheet" href="../../assets/styles.css" />
</head>
<body>
  <header class="site-header">
    <div class="logo"><a href="../../index.html" style="color:#fff; text-decoration:none;">Sales Ops Manual</a></div>
    <!-- 検索バーを実動させるため id 付与 -->
    <input id="global-search" class="search" type="search" placeholder="キーワードを入力してください" />
  </header>

  <main class="layout">
    <!-- 左：メニュー（ホバーで出現） -->
    <nav class="sidebar" aria-label="メインメニュー">
      <ul id="primary-menu" class="menu"></ul>
    </nav>

    <!-- 右：本文 -->
    <section class="content manual">
      <nav class="breadcrumb">
        <a href="../../index.html">TOP</a> ＞ <span>SFA：Salesforce</span> ＞ <span>商談の作成〜フェーズ管理</span>
      </nav>

      <!-- ※ 重複の「SFA：Salesforce」キッカーは削除 -->
      <h1 class="page-title">商談の作成〜フェーズ管理</h1>

      <!-- 概要：背景＝白／目次セクション風 -->
      <section class="summary-box summary--white" aria-labelledby="summary-label">
        <div class="summary-head" id="summary-label">概要</div>
        <div class="summary-body">
          <p>新規商談の作成から、フェーズ更新、次アクションの登録、クローズまでの運用を解説します。</p>
        </div>
      </section>

      <section class="manual-steps">
        <!-- STEP 1 -->
        <article class="manual-step">
          <div class="manual-left">
            <div class="manual-num">1</div>
            <figure class="manual-figure">
              <img src="https://b2b.allis-co.com/wp-content/uploads/2024/06/e359b7a1d7514dfd7ed5f8122bf04226.jpg" alt="商談タブを開く" />
            </figure>
          </div>
          <div class="manual-right">
            <h3>商談タブから新規作成</h3>
            <p class="manual-desc">［商談］タブで［新規］をクリック。取引先が未作成の場合は先に作成してください。</p>

            <!-- 注意・ルール（濃紺フレーム＋⚠️タブ） -->
            <div class="rule-box rule--caution">
              <div class="rule-label"><span class="ico"></span>注意事項</div>
              <div class="rule-body"><strong>入力規則：</strong> 商談名は「YYYYMMDD_案件名_顧客名」で統一。</div>
            </div>
          </div>
        </article>

        <!-- STEP 2 -->
        <article class="manual-step">
          <div class="manual-left">
            <div class="manual-num">2</div>
            <figure class="manual-figure">
              <img src="https://b2b.allis-co.com/wp-content/uploads/2024/06/e359b7a1d7514dfd7ed5f8122bf04226.jpg" alt="必須項目の入力" />
            </figure>
          </div>
          <div class="manual-right">
            <h3>基本情報の入力</h3>
            <p class="manual-desc">金額、成立確度、受注予定日、フェーズを入力。フェーズは定義に沿って選択。</p>
          </div>
        </article>

        <!-- STEP 3 -->
        <article class="manual-step">
          <div class="manual-left">
            <div class="manual-num">3</div>
            <figure class="manual-figure">
              <img src="https://b2b.allis-co.com/wp-content/uploads/2024/06/e359b7a1d7514dfd7ed5f8122bf04226.jpg" alt="活動の登録" />
            </figure>
          </div>
          <div class="manual-right">
            <h3>次アクションの登録</h3>
            <p class="manual-desc">打ち合わせ・電話・メール等の活動を登録し、期日と担当者を設定します。</p>
          </div>
        </article>
      </section>

      <footer class="site-footer">© <script>document.write(new Date().getFullYear())</script> Link innovation</footer>
    </section>
  </main>

  <!-- 左メニュー構築 & 画像拡大 & 検索 & サイドバー出し入れ -->
  <script>
    /* ===== ナビ定義 ===== */
    const NAV = [
      { id: "salesforce", label: "SFA：Salesforce", items: [
        { label: "はじめに（運用方針）", href: "../salesforce/intro.html" },
        { label: "取引先・取引先責任者の登録", href: "../salesforce/account-contact.html" },
        { label: "商談の作成〜フェーズ管理", href: "../salesforce/opportunity.html" },
        { label: "レポート／ダッシュボード", href: "../salesforce/report.html" },
        { label: "活動・ToDo・Chatter", href: "../salesforce/activity.html" },
      ]},
      { id: "sansan", label: "CRM：Sansan", items: [
        { label: "はじめに（基本操作）", href: "../sansan/intro.html" },
        { label: "名刺の取り込みと表記統一", href: "../sansan/import-normalize.html" },
        { label: "人物統合と重複解消", href: "../sansan/merge.html" },
        { label: "タグ付けと共有", href: "../sansan/tag-share.html" },
        { label: "Salesforce連携", href: "../sansan/sf-sync.html" },
      ]},
      { id: "accountengagement", label: "MA：Account Engagement", items: [
        { label: "はじめに（概念整理）", href: "../ae/intro.html" },
        { label: "フォーム／LPの作成", href: "../ae/forms-landing.html" },
        { label: "スコアリング／グレーディング", href: "../ae/scoring-grading.html" },
        { label: "オートメーション／エンゲージメント", href: "../ae/engagement.html" },
        { label: "Salesforce連携・同期", href: "../ae/sf-integration.html" },
      ]},
      { id: "getting-started", label: "共通：初期セットアップ", items: [
        { label: "アカウント発行フロー", href: "../common/accounts.html" },
        { label: "権限・ロールの考え方", href: "../common/roles.html" },
        { label: "命名規則とID体系", href: "../common/naming.html" },
        { label: "連携マップ（全体像）", href: "../common/integration-map.html" },
        { label: "トラブルシュートの基本", href: "../common/troubleshoot.html" },
      ]},
      { id: "governance", label: "共通：データガバナンス", items: [
        { label: "重複チェックの運用", href: "../common/dedupe.html" },
        { label: "項目設計ガイド", href: "../common/field-design.html" },
        { label: "データ品質監視", href: "../common/data-quality.html" },
        { label: "匿名化・削除ポリシー", href: "../common/privacy.html" },
        { label: "変更申請フロー", href: "../common/change-request.html" },
      ]},
      { id: "faq", label: "FAQ／ベストプラクティス", items: [
        { label: "パーミッションで詰まったら", href: "../faq/permissions.html" },
        { label: "レポート設計のコツ", href: "../faq/reporting-tips.html" },
        { label: "名寄せの落とし穴", href: "../faq/merge-pitfalls.html" },
        { label: "MAとSFAの同期遅延", href: "../faq/sync-latency.html" },
        { label: "問い合わせ先", href: "../faq/contact.html" },
      ]},
    ];

    /* ===== 左メニュー描画 ===== */
    const primaryMenu = document.getElementById('primary-menu');
    NAV.forEach((s) => {
      const li = document.createElement('li');
      li.className = 'menu-item';
      li.innerHTML = `
        <button class="menu-btn" data-id="${s.id}">${s.label}</button>
        <ul class="submenu" data-parent="${s.id}" hidden></ul>
      `;
      primaryMenu.appendChild(li);
    });
    function openSubmenu(id) {
      document.querySelectorAll('.submenu').forEach(ul => { ul.hidden = true; ul.innerHTML=''; });
      document.querySelectorAll('.menu-btn').forEach(b => b.classList.toggle('active', b.dataset.id === id));
      const sec = NAV.find(s => s.id === id); if (!sec) return;
      const holder = document.querySelector(`.submenu[data-parent="${id}"]`);
      sec.items.forEach(item => {
        const li = document.createElement('li');
        li.innerHTML = `<a class="submenu-link" href="${item.href}">${item.label}</a>`;
        holder.appendChild(li);
      });
      holder.hidden = false;
    }
    openSubmenu('salesforce');
    const here = [...document.querySelectorAll('.submenu-link')].find(a => a.getAttribute('href')?.endsWith('/opportunity.html'));
    if (here) here.classList.add('is-current');

    /* ===== 画像クリック拡大（lightbox） ===== */
    document.addEventListener("DOMContentLoaded", () => {
      const lightbox = document.createElement("div");
      lightbox.className = "lightbox";
      lightbox.innerHTML = `<img src="" alt="拡大画像">`;
      document.body.appendChild(lightbox);
      const lightboxImg = lightbox.querySelector("img");
      document.querySelectorAll(".manual-figure img").forEach(img => {
        img.addEventListener("click", () => { lightboxImg.src = img.src; lightbox.classList.add("show"); });
      });
      lightbox.addEventListener("click", () => { lightbox.classList.remove("show"); lightboxImg.src = ""; });
      document.addEventListener("keydown", e => { if (e.key === "Escape") lightbox.classList.remove("show"); });
    });

    /* ===== 検索（TOPと同じ動き） ===== */
    (function(){
      const input = document.getElementById('global-search');
      if (!input) return;
      const tokenize = q => q.trim().toLowerCase().split(/\s+/).filter(Boolean);
      let INDEX=null;
      async function loadIndex(){
        if (INDEX) return INDEX;
        const res = await fetch('../../search-index.json', {cache:'no-store'});
        INDEX = await res.json();
        return INDEX;
      }
      function searchDocs(index, query){
        const tokens = tokenize(query);
        if (!tokens.length) return [];
        return index.map(doc=>{
          const hay=(doc.title+' '+(doc.tags||[]).join(' ')).toLowerCase();
          const ok=tokens.every(t=>hay.includes(t));
          let score=0;
          if(ok){ tokens.forEach(t=>{ if(doc.title.toLowerCase().includes(t)) score+=3; if((doc.tags||[]).join(' ').toLowerCase().includes(t)) score+=1; }); }
          return ok?{...doc,score}:null;
        }).filter(Boolean).sort((a,b)=>b.score-a.score).slice(0,60);
      }
      function showResults(items,q){
        // 結果はそのまま遷移でOK。ここでは最上位を開く or 別タブなどにしたければ調整
        if(items[0]) location.href = '../../' + items[0].url.replace(/^\/?/,'');
      }
      input.addEventListener('keydown', async e=>{
        if(e.key!=='Enter') return;
        const q=input.value.trim(); if(!q) return;
        const idx=await loadIndex(); const items=searchDocs(idx,q); showResults(items,q);
      });
    })();

    /* ===== サイドバーの出し入れ（ホットゾーン） ===== */
    (function(){
      const zone = document.createElement('div');
      zone.className = 'edge-hotzone';
      document.body.appendChild(zone);
      const OPEN_CLASS = 'sidebar-open';
      let closeTimer=null;
      const open = ()=>{ if(closeTimer){clearTimeout(closeTimer);closeTimer=null;} document.body.classList.add(OPEN_CLASS); };
      const closeLater = ()=>{ if(closeTimer) clearTimeout(closeTimer); closeTimer=setTimeout(()=>document.body.classList.remove(OPEN_CLASS),200); };
      zone.addEventListener('mouseenter', open);
      zone.addEventListener('mouseleave', closeLater);
      const sidebar=document.querySelector('.sidebar');
      if(sidebar){ sidebar.addEventListener('mouseenter', open); sidebar.addEventListener('mouseleave', closeLater); }
      document.addEventListener('keydown', e=>{ if(e.key==='Escape') document.body.classList.remove(OPEN_CLASS); });
      document.body.classList.remove(OPEN_CLASS);
    })();
    /* ===== 検索（Enterで実行） ===== */
(function(){
  const input = document.getElementById('global-search');
  if (!input) return;

  const tokenize = q => q.trim().toLowerCase().split(/\s+/).filter(Boolean);
  let INDEX=null;

  async function loadIndex(){
    if (INDEX) return INDEX;
    const res = await fetch('../../search-index.json', {cache:'no-store'}); // ← 相対パス注意
    INDEX = await res.json();
    return INDEX;
  }

  function searchDocs(index, query){
    const tokens = tokenize(query);
    if (!tokens.length) return [];
    return index.map(doc=>{
      const hay=(doc.title+' '+(doc.tags||[]).join(' ')).toLowerCase();
      const ok=tokens.every(t=>hay.includes(t));
      let score=0;
      if(ok){
        tokens.forEach(t=>{
          if(doc.title.toLowerCase().includes(t)) score+=3;
          if((doc.tags||[]).join(' ').toLowerCase().includes(t)) score+=1;
        });
      }
      return ok?{...doc,score}:null;
    }).filter(Boolean).sort((a,b)=>b.score-a.score).slice(0,60);
  }

  function navigateTo(item){
    if(!item) return;
    // ルート相対のURL（例: "pages/faq/xxx.html"）を現在階層からの相対に変換
    location.href = '../../' + item.url.replace(/^\/?/,'');
  }

  input.addEventListener('keydown', async e=>{
    if(e.key!=='Enter') return;
    const q=input.value.trim(); if(!q) return;
    const idx=await loadIndex();
    const items=searchDocs(idx,q);
    navigateTo(items[0]);  // 最上位に遷移（必要なら結果一覧UIに差し替え可）
  });
})();
  </script>
</body>
</html>
