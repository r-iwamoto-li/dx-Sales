<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>å–¶æ¥­æ”¯æ´ãƒãƒ‹ãƒ¥ã‚¢ãƒ«ãƒãƒ¼ã‚¿ãƒ«</title>
  <link rel="stylesheet" href="assets/styles.css" />
</head>
<body>
<header class="site-header">
  <div class="logo">Sales Ops Manual</div>
  <input id="global-search" class="search" type="search" placeholder="ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„" />
</header>

<main class="layout">
  <!-- å·¦ï¼šãƒ¡ãƒ‹ãƒ¥ãƒ¼ï¼ˆnav.js ãŒç”Ÿæˆï¼‰ -->
  <nav class="sidebar" aria-label="ãƒ¡ã‚¤ãƒ³ãƒ¡ãƒ‹ãƒ¥ãƒ¼">
    <ul id="primary-menu" class="menu"></ul>
  </nav>

  <!-- å³ï¼šãƒ©ãƒ³ãƒ‡ã‚£ãƒ³ã‚° -->
  <section class="content">
    <div class="hero">
      <div class="hero-search">
        <input id="hero-search-input" type="search" placeholder="ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ä¸‹ã•ã„" aria-label="ã‚µã‚¤ãƒˆå†…æ¤œç´¢" />
        <button id="hero-filter-btn" class="btn-filter" type="button">çµã‚Šè¾¼ã¿</button>
      </div>
    </div>

    <!-- æ¤œç´¢çµæœï¼ˆã‚«ãƒ¼ãƒ‰UIï¼‰ -->
    <section id="search-results" class="home-section" style="display:none;">
      <h2 class="home-h2">æ¤œç´¢çµæœ</h2>
      <div class="result-head">
        <span id="result-count"></span>
        <button id="clear-search" class="btn-clear" type="button">ã‚¯ãƒªã‚¢</button>
      </div>
      <div class="result-grid" id="result-grid"></div>
    </section>

    <!-- ğŸ‘‡ æ–°ç€ã¯å»ƒæ­¢ã€‚NAVãƒ™ãƒ¼ã‚¹ã®â€œç›®æ¬¡â€ã‚’è¡¨ç¤º -->
    <section class="home-section">
      <h2 class="home-h2">ç›®æ¬¡</h2>
      <div class="popular-grid" id="toc-grid"></div>
    </section>
  </section>
</main>

<footer class="site-footer">Â© <span id="y"></span> Link innovation</footer>

<!-- å…±é€šãƒŠãƒ“ï¼ˆé‡è¤‡é˜²æ­¢ã¤ãï¼‰ -->
<script src="assets/nav.js"></script>

<script>
  // ã‚µã‚¤ãƒ‰ãƒãƒ¼åˆæœŸåŒ–ï¼ˆé‡è¤‡é˜²æ­¢ã¤ãï¼‰
  window.initPortalNav?.();

  // ====== ç›®æ¬¡ï¼ˆNAVã‹ã‚‰è‡ªå‹•ç”Ÿæˆï¼‰ ======
  const TOC = window.PORTAL_NAV || [];
  const tocGrid = document.getElementById('toc-grid');
  if (tocGrid) {
    tocGrid.innerHTML = TOC.map(block => `
      <div class="pop-card">
        <div class="pop-head"><span class="pop-tag">${block.label}</span></div>
        <ol class="pop-ol">
          ${block.items.map((it,i)=>`
            <li><a href="${it.href}"><span class="rank">${i+1}.</span> ${it.label}</a></li>
          `).join('')}
        </ol>
      </div>
    `).join('');
  }

  // ====== æ¤œç´¢ï¼ˆTOPã§ã‚«ãƒ¼ãƒ‰è¡¨ç¤ºã™ã‚‹ç‰ˆï¼‰ ======
  const searchInput = document.getElementById('global-search');
  const heroInput   = document.getElementById('hero-search-input');
  const heroBtn     = document.getElementById('hero-filter-btn');
  const resultWrap  = document.getElementById('search-results');
  const resultGrid  = document.getElementById('result-grid');
  const resultCount = document.getElementById('result-count');
  const clearBtn    = document.getElementById('clear-search');

  let SEARCH_INDEX = null;
  async function loadIndex(){
    if (SEARCH_INDEX) return SEARCH_INDEX;
    const res = await fetch('search-index.json', {cache: 'no-store'});
    SEARCH_INDEX = await res.json();
    return SEARCH_INDEX;
  }
  const tokenize = q => q.trim().toLowerCase().split(/\s+/).filter(Boolean);

  function searchDocs(index, query){
    const tokens = tokenize(query);
    if (!tokens.length) return [];
    return index
      .map(doc => {
        const hay = (doc.title + ' ' + (doc.tags||[]).join(' ')).toLowerCase();
        const ok = tokens.every(t => hay.includes(t));
        let score = 0;
        if (ok){
          tokens.forEach(t => {
            if (doc.title.toLowerCase().includes(t)) score += 3;
            if ((doc.tags||[]).join(' ').toLowerCase().includes(t)) score += 1;
          });
        }
        return ok ? {...doc, score} : null;
      })
      .filter(Boolean)
      .sort((a,b)=> b.score - a.score)
      .slice(0,60);
  }

  function renderResults(items, query){
    resultWrap.style.display = '';
    resultCount.textContent = `ã€Œ${query}ã€ã®çµæœï¼š${items.length}ä»¶`;
    resultGrid.innerHTML = items.map(it => `
      <a class="result-card" href="${it.url}" title="${it.title}">
        <div class="result-title">${it.title}</div>
      </a>
    `).join('') || `<div class="result-empty">è©²å½“ã™ã‚‹ãƒšãƒ¼ã‚¸ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚</div>`;
    resultWrap.scrollIntoView({behavior:'smooth', block:'start'});
  }

  function clearSearch(){
    resultWrap.style.display = 'none';
    resultGrid.innerHTML = '';
    resultCount.textContent = '';
    if (searchInput) searchInput.value = '';
    if (heroInput) heroInput.value = '';
  }
  clearBtn.addEventListener('click', clearSearch);

  async function doSearch(q){
    const index = await loadIndex();
    const items = searchDocs(index, q);
    renderResults(items, q);
  }
  function onSubmitFrom(el){
    const q = el.value.trim();
    if (!q) return;
    doSearch(q);
  }
  if (searchInput) searchInput.addEventListener('keydown', e => { if (e.key === 'Enter') onSubmitFrom(e.target); });
  if (heroInput)   heroInput.addEventListener('keydown', e => { if (e.key === 'Enter') onSubmitFrom(e.target); });
  if (heroBtn)     heroBtn.addEventListener('click', () => onSubmitFrom(heroInput || searchInput));

  // å¹´
  document.getElementById('y').textContent = new Date().getFullYear();
</script>
</body>
</html>
