<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>営業支援マニュアルポータル</title>
  <link rel="stylesheet" href="assets/styles.css" />
</head>
<body>
  <header class="site-header">
    <div class="logo">Sales Ops Manual</div>
    <input id="global-search" class="search" type="search" placeholder="キーワードを入力してください" />
  </header>

  <main class="layout">
    <!-- 左：第1階層（クリックで直下に第2階層が展開） -->
    <nav class="sidebar" aria-label="メインメニュー">
      <ul id="primary-menu" class="menu"></ul>
    </nav>

    <!-- 右：初期は“サイト説明＋おすすめ”、選択後はセクションの説明 -->
    <section class="content">
      <!-- 初期のヒーロー -->
      <section id="hero" class="hero">
        <h1 class="hero-title">営業支援マニュアルへようこそ</h1>
        <p class="hero-lead">
          このサイトは、SFA（Salesforce）／CRM（Sansan）／MA（Account Engagement）の運用手順を、共通ガイドとともに体系化したナレッジハブです。<br />
          左の大項目からツールまたはカテゴリを選択し、表示された中項目（手順カテゴリ）に進んでください。
        </p>

        <h2 class="topics-title">おすすめTopics</h2>
        <div id="topics-grid" class="topics-grid"></div>
      </section>

      <!-- セクション情報（大項目選択後に表示） -->
      <section id="section-panel" class="section-panel" hidden>
        <h1 id="section-title" class="section-title"></h1>
        <p id="section-desc" class="section-desc"></p>
        <p class="panel-hint">左メニューの中項目から、見たい手順ページを選んでください。</p>
      </section>
    </section>
  </main>

  <footer class="site-footer">
    © <span id="y"></span> Link innovation
  </footer>

  <script>
    // --- 大項目・中項目データ ---
    const NAV = [
      {
        id: "salesforce",
        label: "SFA：Salesforce",
        desc: "商談管理・取引先・活動記録の運用手順",
        items: [
          { label: "はじめに（運用方針）", href: "pages/salesforce/intro.html" },
          { label: "取引先・取引先責任者の登録", href: "pages/salesforce/account-contact.html" },
          { label: "商談の作成〜フェーズ管理", href: "pages/salesforce/opportunity.html" },
          { label: "レポート／ダッシュボード", href: "pages/salesforce/report.html" },
          { label: "活動・ToDo・Chatter", href: "pages/salesforce/activity.html" },
        ]
      },
      {
        id: "sansan",
        label: "CRM：Sansan",
        desc: "名刺管理・人物統合・連携の運用手順",
        items: [
          { label: "はじめに（基本操作）", href: "pages/sansan/intro.html" },
          { label: "名刺の取り込みと表記統一", href: "pages/sansan/import-normalize.html" },
          { label: "人物統合と重複解消", href: "pages/sansan/merge.html" },
          { label: "タグ付けと共有", href: "pages/sansan/tag-share.html" },
          { label: "Salesforce連携", href: "pages/sansan/sf-sync.html" },
        ]
      },
      {
        id: "accountengagement",
        label: "MA：Account Engagement",
        desc: "フォーム・スコアリング・ナーチャリングの手順",
        items: [
          { label: "はじめに（概念整理）", href: "pages/ae/intro.html" },
          { label: "フォーム／LPの作成", href: "pages/ae/forms-landing.html" },
          { label: "スコアリング／グレーディング", href: "pages/ae/scoring-grading.html" },
          { label: "オートメーション／エンゲージメント", href: "pages/ae/engagement.html" },
          { label: "Salesforce連携・同期", href: "pages/ae/sf-integration.html" },
        ]
      },
      {
        id: "getting-started",
        label: "共通：初期セットアップ",
        desc: "アカウント発行・権限・環境準備",
        items: [
          { label: "アカウント発行フロー", href: "pages/common/accounts.html" },
          { label: "権限・ロールの考え方", href: "pages/common/roles.html" },
          { label: "命名規則とID体系", href: "pages/common/naming.html" },
          { label: "連携マップ（全体像）", href: "pages/common/integration-map.html" },
          { label: "トラブルシュートの基本", href: "pages/common/troubleshoot.html" },
        ]
      },
      {
        id: "governance",
        label: "共通：データガバナンス",
        desc: "重複排除・クレンジング・監査",
        items: [
          { label: "重複チェックの運用", href: "pages/common/dedupe.html" },
          { label: "項目設計ガイド", href: "pages/common/field-design.html" },
          { label: "データ品質監視", href: "pages/common/data-quality.html" },
          { label: "匿名化・削除ポリシー", href: "pages/common/privacy.html" },
          { label: "変更申請フロー", href: "pages/common/change-request.html" },
        ]
      },
      {
        id: "faq",
        label: "FAQ／ベストプラクティス",
        desc: "よくある質問・運用Tips",
        items: [
          { label: "パーミッションで詰まったら", href: "pages/faq/permissions.html" },
          { label: "レポート設計のコツ", href: "pages/faq/reporting-tips.html" },
          { label: "名寄せの落とし穴", href: "pages/faq/merge-pitfalls.html" },
          { label: "MAとSFAの同期遅延", href: "pages/faq/sync-latency.html" },
          { label: "問い合わせ先", href: "pages/faq/contact.html" },
        ]
      },
    ];

    // --- おすすめTopics（自由に差し替えOK） ---
    const TOPICS = [
      { label: "まず読む：運用全体像", href: "pages/common/integration-map.html" },
      { label: "商談フェーズ定義", href: "pages/salesforce/opportunity.html" },
      { label: "名刺の表記統一ルール", href: "pages/sansan/import-normalize.html" },
      { label: "スコアリング入門", href: "pages/ae/scoring-grading.html" },
      { label: "データ重複の対策", href: "pages/common/dedupe.html" },
      { label: "レポート作成のコツ", href: "pages/faq/reporting-tips.html" },
    ];

    // --- 要素参照 ---
    const primaryMenu = document.getElementById('primary-menu');
    const hero         = document.getElementById('hero');
    const topicsGrid   = document.getElementById('topics-grid');
    const sectionPanel = document.getElementById('section-panel');
    const sectionTitle = document.getElementById('section-title');
    const sectionDesc  = document.getElementById('section-desc');

    // ヒーローのおすすめトピック描画
    function renderTopics(){
      topicsGrid.innerHTML = '';
      TOPICS.forEach(t => {
        const a = document.createElement('a');
        a.className = 'topic';
        a.href = t.href;
        a.textContent = t.label;
        topicsGrid.appendChild(a);
      });
    }

    // 左メニュー描画（大項目＋空のサブリスト）
    function renderPrimary(){
      primaryMenu.innerHTML = '';
      NAV.forEach(sec => {
        const li = document.createElement('li');
        li.className = 'menu-item';
        li.innerHTML = `
          <button class="menu-btn" data-id="${sec.id}" aria-expanded="false">
            ${sec.label}
            <span class="caret" aria-hidden="true">▸</span>
          </button>
          <ul class="submenu" data-parent="${sec.id}" hidden></ul>
        `;
        primaryMenu.appendChild(li);
      });
    }

    // 指定idの中項目を、該当のsubmenuに展開
    function openSection(id){
      // すべて閉じる
      document.querySelectorAll('.submenu').forEach(ul => { ul.hidden = true; ul.innerHTML = ''; });
      document.querySelectorAll('.menu-btn').forEach(b => { b.classList.remove('active'); b.setAttribute('aria-expanded','false'); b.querySelector('.caret').textContent = '▸'; });

      // 対象セクション
      const data = NAV.find(s => s.id === id);
      const sub  = document.querySelector(`.submenu[data-parent="${id}"]`);
      const btn  = document.querySelector(`.menu-btn[data-id="${id}"]`);
      if(!data || !sub || !btn) return;

      // サブを構築
      sub.innerHTML = data.items.map(item => `
        <li><a class="submenu-link" href="${item.href}">${item.label}</a></li>
      `).join('');
      sub.hidden = false;
      btn.classList.add('active');
      btn.setAttribute('aria-expanded','true');
      btn.querySelector('.caret').textContent = '▾';

      // 右パネル切替
      hero.hidden = true;
      sectionPanel.hidden = false;
      sectionTitle.textContent = data.label;
      sectionDesc.textContent  = data.desc;
    }

    // クリックイベント（委任）
    primaryMenu.addEventListener('click', (e) => {
      if (e.target.closest('.menu-btn')) {
        const id = e.target.closest('.menu-btn').dataset.id;
        // すでに開いているものを再クリック → 閉じてヒーローに戻す
        const expanded = e.target.closest('.menu-btn').getAttribute('aria-expanded') === 'true';
        if (expanded){
          // 全閉じ＆ヒーローへ
          document.querySelectorAll('.submenu').forEach(ul => { ul.hidden = true; ul.innerHTML=''; });
          document.querySelectorAll('.menu-btn').forEach(b => { b.classList.remove('active'); b.setAttribute('aria-expanded','false'); b.querySelector('.caret').textContent='▸'; });
          sectionPanel.hidden = true; hero.hidden = false;
        } else {
          openSection(id);
        }
      }
    });

    // 初期レンダリング
    renderPrimary();
    renderTopics();
    document.getElementById('y').textContent = new Date().getFullYear();
  </script>
</body>
</html>
